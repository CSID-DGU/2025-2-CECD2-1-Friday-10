import { useEffect, useState } from "react";

export type Lang = "zh" | "en" | "ko";

const STORAGE_KEY = "app.lang";

const dictionaries: Record<Lang, Record<string, string>> = {
  ko: {
    "brand": "AI 태권도",
    "nav.training": "훈련",
    "nav.videos": "훈련 영상",
    "nav.profile": "사용자 센터",
    "nav.logout": "로그아웃",
    "footer.copyrightBrand": "AI 태권도 트레이닝",
    "footer.powered": "Skeleton & AI 분석 기반",

    "home.advantages.title": "AI 태권도의 강점",
    "home.advantages.1": "언제 어디서나 훈련 가능",
    "home.advantages.2": "실시간 포즈 추적과 피드백",
    "home.advantages.3": "정량 평가와 시각화로 성과 확인",
    "home.tech.title": "기술 소개",
    "home.tech.p1": "컴퓨터 비전으로 2D/3D 포즈 키포인트를 추출하고 시간적 분석·품질 평가 모델을 결합하여 안정성/밸런스/속도/연결성을 정량 평가합니다.",
    "home.tech.p2": "훈련 과정을 ‘계획 → 연습 → 복기 → 조정’으로 표준화하여 불필요한 소모를 줄이고 집중도와 효율을 높입니다.",
    "home.tech.point1": "2D/3D 키포인트 추출",
    "home.tech.point2": "시계열/품질 평가 모델 결합",
    "home.tech.point3": "안정성·밸런스·속도·연결성 정량 평가",
    "home.tech.point4": "계획→연습→복기→조정 표준화 루프",
    "home.tabs.login": "로그인",
    "home.tabs.register": "회원가입",
    "home.form.account": "계정",
    "home.form.account.placeholder": "아이디를 입력하세요",
    "home.form.password": "비밀번호",
    "home.form.password.placeholder": "비밀번호를 입력하세요",
    "home.form.login.submit": "로그인",
    "home.form.register.account": "계정",
    "home.form.register.email": "이메일",
    "home.form.register.password": "비밀번호",
    "home.form.register.submit": "가입 후 시작",
    "home.social.kakao": "Kakao 로그인",
    "home.social.google": "Google 로그인",
    "home.social.note": "제3자 계정은 데모용이며 실제 OAuth 연동은 포함되어 있지 않습니다.",
    "home.lang.title": "언어 선택",
    "home.lang.zh": "中文",
    "home.lang.en": "English",
    "home.lang.ko": "한국어",

    "error.login.invalid": "계정 또는 비밀번호가 올바르지 않습니다.",
    "error.login.fail": "로그인 실패",
    "error.register.fail": "회원가입 실패",
    "error.form.missing": "모든 항목을 입력하세요.",
    "error.email.invalid": "올바른 이메일 주소를 입력하세요.",

    "training.title": "훈련 센터",
    "training.tab.capture": "스켈레톤 캡처",
    "training.tab.analysis": "평가 분석",
    "training.camera.title": "카메라 미리보기",
    "training.camera.off": "카메라가 꺼져 있습니다",
    "training.camera.unsupported": "현재 브라우저는 카메라 접근을 지원하지 않습니다(HTTPS 또는 localhost 필요).",
    "training.camera.noAccess": "카메라에 접근할 수 없습니다. 권한 설정을 확인하세요.",
    "training.camera.btnOn": "카메라 켜기",
    "training.camera.btnOff": "카메라 끄기",
    "training.record.status": "현재 상태",
    "training.record.recording": "녹화 중...",
    "training.record.idle": "대기",
    "training.record.start": "녹화 시작",
    "training.record.stop": "녹화 중지",
    "training.save.mock": "녹화 파일 저장(Mock)",
    "training.upload.title": "파일 업로드 후 분석",
    "training.upload.empty": "아직 업로드한 파일이 없습니다",
    "training.viewer.title": "스켈레톤 뷰어",
    "training.analysis.title": "평가 조건",
    "training.analysis.poomsae": "품새 선택",
    "training.analysis.record": "훈련 기록",
    "training.analysis.choose": "기록을 선택하세요",
    "training.analysis.run": "분석 실행",
    "training.result.title": "분석 결과",
    "training.result.total": "종합 점수",
    "training.result.table.metric": "지표",
    "training.result.table.score": "점수",
    "training.result.table.graph": "그래프",
    "training.result.empty": "기록을 선택하고 ‘분석 실행’을 눌러 결과를 확인하세요.",
    "training.metric.stability": "자세 안정성",
    "training.metric.balance": "밸런스",
    "training.metric.speed": "속도",
    "training.metric.continuity": "연결성",

    "videos.title": "내 훈련 영상",
    "videos.table.title": "제목",
    "videos.table.date": "날짜",
    "videos.table.score": "점수",
    "videos.table.action": "작업",
    "videos.action.view": "보기",
    "videos.action.download": "다운로드",
    "videos.modal.dateScore": "날짜: {date} ｜ 점수: {score}",
    "videos.modal.preview": "동영상 미리보기",
    "videos.modal.close": "닫기",
    "videos.download.mock": "다운로드(데모): {title}",

    "admin.title": "관리자 센터",
    "admin.search.placeholder": "계정 또는 이메일 검색",
    "admin.table.id": "ID",
    "admin.table.account": "계정",
    "admin.table.email": "이메일",
    "admin.table.created": "가입일",
    "admin.table.role": "권한",
    "admin.table.status": "상태",
    "admin.table.action": "작업",
    "admin.role.admin": "관리자",
    "admin.role.user": "일반 사용자",
    "admin.status.active": "정상",
    "admin.status.blocked": "차단됨",
    "admin.action.toggleRole": "권한 전환",
    "admin.action.toggleBlock": "차단",
    "admin.action.unblock": "복구",
    "admin.action.delete": "삭제",
    "admin.confirm.delete": "해당 사용자를 삭제하시겠습니까?",
    "admin.empty": "일치하는 사용자가 없습니다",
    "admin.logout": "로그아웃",

    "profile.title": "사용자 센터",
    "profile.menu.profile": "개인정보",
    "profile.menu.training": "나의 훈련",
    "profile.menu.courses": "나의 강의",
    "profile.menu.videos": "영상 업로드",
    "profile.menu.plans": "나의 계획",
    "profile.menu.ai": "AI 분석 이력",
    "profile.info.account": "계정",
    "profile.info.email": "이메일",
    "profile.info.rank": "단",
    "profile.info.favorite": "선호 훈련",
    "profile.info.rankInput": "단",
    "profile.training.title": "나의 훈련 데이터",
    "profile.training.kpi1": "이번 주 훈련 시간",
    "profile.training.kpi2": "표준 동작 점수(최근 30일)",
    "profile.training.kpi3": "완료도",
    "profile.training.note": "일/주/월 차트는 추후 Chart.js 연동 예정이며, 현재는 진행 바로 대체합니다.",
    "profile.courses.title": "강의 학습 진행",
    "profile.courses.header.course": "강의",
    "profile.courses.header.progress": "진행",
    "profile.courses.header.next": "다음 단계",
    "profile.videos.title": "영상 업로드 관리",
    "profile.videos.header.title": "제목",
    "profile.videos.header.date": "날짜",
    "profile.videos.header.score": "점수",
    "profile.videos.header.action": "작업",
    "profile.videos.play": "재생",
    "profile.videos.download": "다운로드",
    "profile.videos.delete": "삭제",
    "profile.videos.empty": "영상이 없습니다",
    "profile.plans.title": "훈련 목표 관리",
    "profile.plans.form.title": "계획 제목",
    "profile.plans.form.placeholder": "예: 주 3회 품새 훈련",
    "profile.plans.form.weekMin": "주간 목표(분)",
    "profile.plans.form.reminder": "알림(선택)",
    "profile.plans.add": "계획 추가",
    "profile.plans.itemMeta": "목표: 주 {min} 분 {rem}",
    "profile.plans.delete": "삭제",
    "profile.plans.empty": "아직 추가된 계획이 없습니다",
    "profile.ai.title": "AI 동작 분석 이력",
    "profile.ai.header.date": "날짜",
    "profile.ai.header.score": "점수",
    "profile.ai.header.tips": "개선 포인트"
  },
  zh: {
    "brand": "AI 跆拳道",
    "nav.training": "训练",
    "nav.videos": "训练视频",
    "nav.profile": "用户中心",
    "nav.logout": "退出登录",
    "footer.copyrightBrand": "AI 跆拳道训练",
    "footer.powered": "基于 Skeleton 与 AI 分析",
    "home.advantages.title": "AI 跆拳道的优势",
    "home.advantages.1": "随时随地训练",
    "home.advantages.2": "实时姿态追踪与反馈",
    "home.advantages.3": "量化评分与可视化",
    "home.tech.title": "技术介绍",
    "home.tech.p1": "通过计算机视觉提取 2D/3D 骨架关键点，结合时序分析与质量评估模型对稳定性/平衡/速度/连贯性进行量化评分。",
    "home.tech.p2": "训练流程“计划→练习→复盘→调整”标准化，减少无效练习，提高效率。",
    "home.tech.point1": "提取 2D/3D 骨架关键点",
    "home.tech.point2": "时序分析 / 质量评估模型融合",
    "home.tech.point3": "稳定性·平衡·速度·连贯性量化评估",
    "home.tech.point4": "计划→练习→复盘→调整 标准化循环",
    "home.tabs.login": "登录",
    "home.tabs.register": "注册",
    "home.form.account": "账号",
    "home.form.account.placeholder": "请输入账号",
    "home.form.password": "密码",
    "home.form.password.placeholder": "请输入密码",
    "home.form.login.submit": "登录",
    "home.form.register.account": "账号",
    "home.form.register.email": "邮箱",
    "home.form.register.password": "密码",
    "home.form.register.submit": "注册并开始",
    "home.social.kakao": "Kakao 登录",
    "home.social.google": "Google 登录",
    "home.social.note": "第三方账号仅作演示，未接入真实 OAuth。",
    "home.lang.title": "语言选择",
    "home.lang.zh": "中文",
    "home.lang.en": "English",
    "home.lang.ko": "한국어",
    "error.login.invalid": "账号或密码错误",
    "error.login.fail": "登录失败",
    "error.register.fail": "注册失败",
    "error.form.missing": "请填写完整信息",
    "error.email.invalid": "请输入正确的邮箱地址",
    "training.title": "训练中心",
    "training.tab.capture": "Skeleton 捕捉",
    "training.tab.analysis": "评价分析",
    "training.camera.title": "Camera 预览",
    "training.camera.off": "摄像头未开启",
    "training.camera.unsupported": "当前浏览器不支持摄像头访问（需要 HTTPS 或 localhost）。",
    "training.camera.noAccess": "无法访问摄像头，请检查权限设置。",
    "training.camera.btnOn": "开启摄像头",
    "training.camera.btnOff": "关闭摄像头",
    "training.record.status": "当前状态",
    "training.record.recording": "录制中...",
    "training.record.idle": "未录制",
    "training.record.start": "开始录制",
    "training.record.stop": "停止录制",
    "training.save.mock": "保存录制文件（Mock）",
    "training.upload.title": "上传已有文件进行分析",
    "training.upload.empty": "尚未上传任何文件",
    "training.viewer.title": "Skeleton Viewer",
    "training.analysis.title": "评价条件",
    "training.analysis.poomsae": "品势选择",
    "training.analysis.record": "训练记录",
    "training.analysis.choose": "请选择记录",
    "training.analysis.run": "执行分析",
    "training.result.title": "分析结果",
    "training.result.total": "综合得分",
    "training.result.table.metric": "指标",
    "training.result.table.score": "得分",
    "training.result.table.graph": "图示",
    "training.result.empty": "请选择记录并点击“执行分析”以查看结果。",
    "training.metric.stability": "姿势稳定度",
    "training.metric.balance": "平衡控制",
    "training.metric.speed": "出击速度",
    "training.metric.continuity": "动作连贯性",
    "videos.title": "我的训练视频",
    "videos.table.title": "名称",
    "videos.table.date": "日期",
    "videos.table.score": "得分",
    "videos.table.action": "操作",
    "videos.action.view": "查看",
    "videos.action.download": "下载",
    "videos.modal.dateScore": "日期：{date} ｜ 得分：{score}",
    "videos.modal.preview": "视频预览占位区域",
    "videos.modal.close": "关闭",
    "videos.download.mock": "模拟下载：{title}",
    "admin.title": "管理员中心",
    "admin.search.placeholder": "按账号或邮箱搜索",
    "admin.table.id": "ID",
    "admin.table.account": "账号",
    "admin.table.email": "邮箱",
    "admin.table.created": "注册日期",
    "admin.table.role": "权限",
    "admin.table.status": "状态",
    "admin.table.action": "操作",
    "admin.role.admin": "管理员",
    "admin.role.user": "普通用户",
    "admin.status.active": "正常",
    "admin.status.blocked": "已拉黑",
    "admin.action.toggleRole": "切换权限",
    "admin.action.toggleBlock": "拉黑",
    "admin.action.unblock": "恢复",
    "admin.action.delete": "删除",
    "admin.confirm.delete": "确认删除该用户？",
    "admin.empty": "未找到匹配用户",
    "admin.logout": "退出登录",
    "profile.title": "用户中心",
    "profile.menu.profile": "个人资料",
    "profile.menu.training": "我的训练",
    "profile.menu.courses": "我的课程",
    "profile.menu.videos": "上传视频",
    "profile.menu.plans": "我的计划",
    "profile.menu.ai": "AI 分析历史",
    "profile.info.account": "账号",
    "profile.info.email": "邮箱",
    "profile.info.rank": "段位",
    "profile.info.favorite": "偏好训练",
    "profile.info.rankInput": "段位",
    "profile.training.title": "我的训练数据",
    "profile.training.kpi1": "本周训练时长",
    "profile.training.kpi2": "标准动作评分(近30天)",
    "profile.training.kpi3": "完成度",
    "profile.training.note": "日/周/月图表可后续接入 Chart.js，这里用进度条做占位。",
    "profile.courses.title": "课程学习进度",
    "profile.courses.header.course": "课程",
    "profile.courses.header.progress": "进度",
    "profile.courses.header.next": "下一阶段",
    "profile.videos.title": "上传视频管理",
    "profile.videos.header.title": "名称",
    "profile.videos.header.date": "日期",
    "profile.videos.header.score": "得分",
    "profile.videos.header.action": "操作",
    "profile.videos.play": "播放",
    "profile.videos.download": "下载",
    "profile.videos.delete": "删除",
    "profile.videos.empty": "暂无视频",
    "profile.plans.title": "训练目标管理",
    "profile.plans.form.title": "计划标题",
    "profile.plans.form.placeholder": "例如：每周 3 次品势训练",
    "profile.plans.form.weekMin": "每周目标分钟",
    "profile.plans.form.reminder": "提醒（可选）",
    "profile.plans.add": "添加计划",
    "profile.plans.itemMeta": "目标：每周 {min} 分钟 {rem}",
    "profile.plans.delete": "删除",
    "profile.plans.empty": "尚未添加计划",
    "profile.ai.title": "AI 动作分析历史",
    "profile.ai.header.date": "日期",
    "profile.ai.header.score": "得分",
    "profile.ai.header.tips": "改进要点"
  },
  en: {
    "brand": "AI Taekwondo",
    "nav.training": "Training",
    "nav.videos": "Videos",
    "nav.profile": "Profile",
    "nav.logout": "Log out",
    "footer.copyrightBrand": "AI Taekwondo Training",
    "footer.powered": "Powered by Skeleton & AI Analysis",
    "home.advantages.title": "Advantages of AI Taekwondo",
    "home.advantages.1": "Train anytime, anywhere",
    "home.advantages.2": "Real-time pose tracking and feedback",
    "home.advantages.3": "Quantitative scoring and visualization",
    "home.tech.title": "Technology Overview",
    "home.tech.p1": "Computer vision extracts 2D/3D pose keypoints and combines temporal analysis and quality models to score stability/balance/speed/continuity.",
    "home.tech.p2": "Standardized cycle of Plan → Practice → Review → Adjust improves focus and efficiency.",
    "home.tech.point1": "2D/3D keypoint extraction",
    "home.tech.point2": "Temporal/quality models combined",
    "home.tech.point3": "Quantitative scores: stability/balance/speed/continuity",
    "home.tech.point4": "Standard loop: Plan→Practice→Review→Adjust",
    "home.tabs.login": "Login",
    "home.tabs.register": "Sign up",
    "home.form.account": "Account",
    "home.form.account.placeholder": "Enter account",
    "home.form.password": "Password",
    "home.form.password.placeholder": "Enter password",
    "home.form.login.submit": "Login",
    "home.form.register.account": "Account",
    "home.form.register.email": "Email",
    "home.form.register.password": "Password",
    "home.form.register.submit": "Sign up and start",
    "home.social.kakao": "Kakao Login",
    "home.social.google": "Google Login",
    "home.social.note": "Third-party login is demo only; real OAuth not connected.",
    "home.lang.title": "Language",
    "home.lang.zh": "中文",
    "home.lang.en": "English",
    "home.lang.ko": "한국어",
    "error.login.invalid": "Invalid account or password",
    "error.login.fail": "Login failed",
    "error.register.fail": "Sign up failed",
    "error.form.missing": "Please complete all fields",
    "error.email.invalid": "Enter a valid email address",
    "training.title": "Training Center",
    "training.tab.capture": "Skeleton Capture",
    "training.tab.analysis": "Analysis",
    "training.camera.title": "Camera Preview",
    "training.camera.off": "Camera is off",
    "training.camera.unsupported": "Camera access unsupported (HTTPS or localhost required).",
    "training.camera.noAccess": "Cannot access camera. Check permissions.",
    "training.camera.btnOn": "Turn On",
    "training.camera.btnOff": "Turn Off",
    "training.record.status": "Status",
    "training.record.recording": "Recording...",
    "training.record.idle": "Idle",
    "training.record.start": "Start Recording",
    "training.record.stop": "Stop Recording",
    "training.save.mock": "Save Recording (Mock)",
    "training.upload.title": "Upload File for Analysis",
    "training.upload.empty": "No file uploaded yet",
    "training.viewer.title": "Skeleton Viewer",
    "training.analysis.title": "Analysis Conditions",
    "training.analysis.poomsae": "Poomsae",
    "training.analysis.record": "Record",
    "training.analysis.choose": "Choose a record",
    "training.analysis.run": "Run Analysis",
    "training.result.title": "Result",
    "training.result.total": "Total Score",
    "training.result.table.metric": "Metric",
    "training.result.table.score": "Score",
    "training.result.table.graph": "Graph",
    "training.result.empty": "Please choose a record and run analysis.",
    "training.metric.stability": "Stability",
    "training.metric.balance": "Balance",
    "training.metric.speed": "Speed",
    "training.metric.continuity": "Continuity",
    "videos.title": "My Training Videos",
    "videos.table.title": "Title",
    "videos.table.date": "Date",
    "videos.table.score": "Score",
    "videos.table.action": "Action",
    "videos.action.view": "View",
    "videos.action.download": "Download",
    "videos.modal.dateScore": "Date: {date} ｜ Score: {score}",
    "videos.modal.preview": "Video preview",
    "videos.modal.close": "Close",
    "videos.download.mock": "Download(mock): {title}",
    "admin.title": "Admin Center",
    "admin.search.placeholder": "Search by account or email",
    "admin.table.id": "ID",
    "admin.table.account": "Account",
    "admin.table.email": "Email",
    "admin.table.created": "Created",
    "admin.table.role": "Role",
    "admin.table.status": "Status",
    "admin.table.action": "Action",
    "admin.role.admin": "Admin",
    "admin.role.user": "User",
    "admin.status.active": "Active",
    "admin.status.blocked": "Blocked",
    "admin.action.toggleRole": "Toggle Role",
    "admin.action.toggleBlock": "Block",
    "admin.action.unblock": "Unblock",
    "admin.action.delete": "Delete",
    "admin.confirm.delete": "Delete this user?",
    "admin.empty": "No matched users",
    "admin.logout": "Log out",
    "profile.title": "Profile Center",
    "profile.menu.profile": "Profile",
    "profile.menu.training": "My Training",
    "profile.menu.courses": "My Courses",
    "profile.menu.videos": "Upload Videos",
    "profile.menu.plans": "My Plans",
    "profile.menu.ai": "AI History",
    "profile.info.account": "Account",
    "profile.info.email": "Email",
    "profile.info.rank": "Dan",
    "profile.info.favorite": "Preference",
    "profile.info.rankInput": "Dan",
    "profile.training.title": "My Training Data",
    "profile.training.kpi1": "Weekly Training Time",
    "profile.training.kpi2": "Standard Motion Score (30d)",
    "profile.training.kpi3": "Completion",
    "profile.training.note": "Charts can be integrated later; placeholder bars for now.",
    "profile.courses.title": "Course Progress",
    "profile.courses.header.course": "Course",
    "profile.courses.header.progress": "Progress",
    "profile.courses.header.next": "Next",
    "profile.videos.title": "Video Management",
    "profile.videos.header.title": "Title",
    "profile.videos.header.date": "Date",
    "profile.videos.header.score": "Score",
    "profile.videos.header.action": "Action",
    "profile.videos.play": "Play",
    "profile.videos.download": "Download",
    "profile.videos.delete": "Delete",
    "profile.videos.empty": "No videos",
    "profile.plans.title": "Training Goals",
    "profile.plans.form.title": "Plan Title",
    "profile.plans.form.placeholder": "e.g., Poomsae 3 times/week",
    "profile.plans.form.weekMin": "Weekly Minutes",
    "profile.plans.form.reminder": "Reminder (optional)",
    "profile.plans.add": "Add Plan",
    "profile.plans.itemMeta": "Goal: {min} min/week {rem}",
    "profile.plans.delete": "Delete",
    "profile.plans.empty": "No plans yet",
    "profile.ai.title": "AI Analysis History",
    "profile.ai.header.date": "Date",
    "profile.ai.header.score": "Score",
    "profile.ai.header.tips": "Tips"
  }
};

let currentLang: Lang = (localStorage.getItem(STORAGE_KEY) as Lang) || "ko";

export function getLang(): Lang {
  return currentLang;
}

export function setLang(lang: Lang) {
  currentLang = lang;
  localStorage.setItem(STORAGE_KEY, lang);
  window.dispatchEvent(new CustomEvent("langchange"));
}

export function t(key: string, vars?: Record<string, string | number>) {
  const dict = dictionaries[currentLang] || {};
  let out = dict[key] || key;
  if (vars) {
    Object.keys(vars).forEach((k) => {
      out = out.replace(new RegExp(`\\{${k}\\}`, "g"), String(vars[k]));
    });
  }
  return out;
}

export function useLang(): [Lang, (l: Lang) => void] {
  const [lang, setState] = useState<Lang>(currentLang);
  useEffect(() => {
    const onChange = () => setState(currentLang);
    window.addEventListener("langchange", onChange as EventListener);
    return () => window.removeEventListener("langchange", onChange as EventListener);
  }, []);
  return [lang, setLang];
}


